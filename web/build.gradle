plugins {
    id 'com.github.node-gradle.node'
    id 'java-library'
}

group = 'hydrogen'

sourceCompatibility = '8'
targetCompatibility = '8'

task installNodeModules(type: NpmTask) {
    args = ['install']
}

task checkNodeModules {
    if (!file('node_modules').exists()) {
        dependsOn installNodeModules
    }
}

task start(type: NpmTask) {
    dependsOn checkNodeModules
    args = ['start']
}

task buildStatic(type: NpmTask) {
    dependsOn checkNodeModules
    args = ['run', 'build']
}

task cleanStatic(type: NpmTask) {
    dependsOn checkNodeModules
    args = ['run', 'clean']
}

clean {
    dependsOn cleanStatic
}

processResources {
    dependsOn buildStatic

    from('dist') {
        into '/META-INF/resources'
    }
}

node {
    version = '15.9.0'
    npmVersion = '7.5.4'
    download = true
}

